ggplot(aes(x = year, y = count, fill = outcome)) +
geom_col() +
scale_fill_manual(values = c("success_nests" = "#89c5d6",
"failed_nests" = "darkgrey"),
labels = c("Failed", "Successful")) +
scale_x_continuous(breaks = seq(min(failed.nests$year),
max(failed.nests$year), by = 5)) +
labs(title = "Breeding Outcomes per Year",
x = "Year", y = "Number of Nests", fill = "Outcome") +
theme_bw() +
theme(panel.grid = element_blank())
library(ggplot2)
ggplot(failed.nests, aes(x = year, y = success_prop)) +
geom_line(color = "#89c5d6", linewidth = 1) +
geom_point(color = "#89c5d6") +
scale_x_continuous(breaks = seq(min(failed.nests$year),
max(failed.nests$year), by = 5)) +
scale_y_continuous(limits = c(0,1), labels = scales::percent_format(accuracy = 1)) +
labs(title = "Proportion of Successful Nests per Year",
x = "Year", y = "Success Proportion") +
theme_bw() +
theme(panel.grid = element_blank())
install.packages("usethis")
install.packages("gitcreds")
#| message: false
#| warning: false
install.packages("usethis")
install.packages("gitcreds")
library(gitcreds)
gitcreds_set()
gitcreds_set()
#| message: false
#| warning: false
install.packages("usethis")
install.packages("gitcreds")
#| message: false
#| warning: false
install.packages("usethis")
install.packages("gitcreds")
library(gitcreds)
gitcreds_set()
View(WeatherData)
weather_yearly <- WeatherData %>%
group_by(YEAR) %>%
summarise(
mean_temp   = mean(TEMP, na.rm = TRUE),
max_temp    = max(MAX, na.rm = TRUE),
min_temp    = min(MIN, na.rm = TRUE),
total_rain  = sum(PRCP, na.rm = TRUE),
mean_wind   = mean(WDSP, na.rm = TRUE),
max_wind    = max(MXSPD, na.rm = TRUE),
hail_days   = sum(I_HAIL, na.rm = TRUE),   # number of hail days per year
.groups = "drop"
)
weather_yearly <- WeatherData |>
group_by(YEAR) |>
summarise(
mean_temp   = mean(TEMP, na.rm = TRUE),
max_temp    = max(MAX, na.rm = TRUE),
min_temp    = min(MIN, na.rm = TRUE),
total_rain  = sum(PRCP, na.rm = TRUE),
mean_wind   = mean(WDSP, na.rm = TRUE),
max_wind    = max(MXSPD, na.rm = TRUE),
hail_days   = sum(I_HAIL, na.rm = TRUE),   # number of hail days per year
.groups = "drop"
)
#| message: false
#| warning: false
library(ggpubr)
library(tidyverse)
library(ggplot2)
library(tidyr)
library(dplyr)
library(tidyverse)
library(car)
library(lubridate)
library(janitor)
library(stringr)
vultures <- read.csv("~/Desktop/Vulture Project/Data/93_24 cleaned.csv")
WeatherData <- read.csv("~/Desktop/Vulture Project/Data/Weather.csv")
vultures <- janitor::clean_names(vultures)
colnames(vultures) <- gsub("_", ".", colnames(vultures))
colnames(vultures)
#| message: false
#| warning: false
vultures <- vultures %>%
mutate(ringing.date = ymd(gsub("/", "-", ringing.date)))
vultures.clean <- vultures %>%
filter(!is.na(ringing.date))
vultures.clean <- vultures.clean %>%
mutate(
laying.date = as.character(laying.date),
laying.date = trimws(laying.date),
laying.date = ifelse(laying.date == "" | laying.date %in% c("NA","?"), "0", laying.date),
laying.date = gsub("/", "-", laying.date),
# convert only real dates to Date, keep "0" as is
laying.date = ifelse(laying.date == "0", "0", as.character(ymd(laying.date)))
)
any(vultures.clean$code == 10, na.rm = TRUE)
any(vultures.clean$code == 10, na.rm = TRUE)
active.nests <- vultures.clean %>%
mutate(ringing.date = ymd(gsub("/", "-", ringing.date))) %>%
filter(!is.na(ringing.date)) %>%
mutate(year = year(ringing.date)) %>%
group_by(year) %>%
summarise(
active_nests = n(),
.groups = "drop"
)
ggplot(active.nests, aes(x = year, y = active_nests)) +
geom_col(fill = "#89c5d6", alpha = 0.8) +
geom_smooth(method = "lm", se = TRUE, color = "darkgrey", linewidth = 1) +
scale_x_continuous(breaks = seq(min(active.nests$year),
max(active.nests$year), by = 5)) +
labs(title = "Active Nests per Year",
x = "Year", y = "Active Nests") +
theme_bw() +
theme(panel.grid = element_blank())
failed.nests <- vultures.clean |>
mutate(ringing.date = ymd(gsub("/", "-", as.character(ringing.date)))) |>
filter(!is.na(ringing.date)) |>
mutate(year = year(ringing.date)) |>
group_by(year) |>
summarise(
active_nests   = n(),
success_nests  = sum(!is.na(laying.date) & laying.date != "0" & laying.date != ""),
failed_nests   = active_nests - success_nests,
success_prop   = success_nests / active_nests,
.groups = "drop"
)
head(failed.nests)
all(failed.nests$active_nests ==
failed.nests$success_nests + failed.nests$failed_nests)
failed.nests %>%
select(year, success_nests, failed_nests) %>%
pivot_longer(cols = c(success_nests, failed_nests),
names_to = "outcome", values_to = "count") |>
ggplot(aes(x = year, y = count, fill = outcome)) +
geom_col() +
scale_fill_manual(values = c("success_nests" = "#89c5d6",
"failed_nests" = "darkgrey"),
labels = c("Failed", "Successful")) +
scale_x_continuous(breaks = seq(min(failed.nests$year),
max(failed.nests$year), by = 5)) +
labs(title = "Breeding Outcomes per Year",
x = "Year", y = "Number of Nests", fill = "Outcome") +
theme_bw() +
theme(panel.grid = element_blank())
failed.nests <- vultures.clean |>
mutate(ringing.date = ymd(gsub("/", "-", as.character(ringing.date)))) |>
filter(!is.na(ringing.date)) |>
mutate(year = year(ringing.date)) |>
group_by(year) |>
summarise(
active_nests   = n(),
success_nests  = sum(!is.na(laying.date) & laying.date != "0" & laying.date != ""),
failed_nests   = active_nests - success_nests,
success_prop   = success_nests / active_nests,
.groups = "drop"
)
head(failed.nests)
all(failed.nests$active_nests ==
failed.nests$success_nests + failed.nests$failed_nests)
failed.nests %>%
select(year, success_nests, failed_nests) %>%
pivot_longer(cols = c(success_nests, failed_nests),
names_to = "outcome", values_to = "count") |>
ggplot(aes(x = year, y = count, fill = outcome)) +
geom_col() +
scale_fill_manual(values = c("success_nests" = "#89c5d6",
"failed_nests" = "darkgrey"),
labels = c("Failed", "Successful")) +
scale_x_continuous(breaks = seq(min(failed.nests$year),
max(failed.nests$year), by = 5)) +
labs(title = "Breeding Outcomes per Year",
x = "Year", y = "Number of Nests", fill = "Outcome") +
theme_bw() +
theme(panel.grid = element_blank())
library(ggplot2)
ggplot(failed.nests, aes(x = year, y = success_prop)) +
geom_line(color = "#89c5d6", linewidth = 1) +
geom_point(color = "#89c5d6") +
scale_x_continuous(breaks = seq(min(failed.nests$year),
max(failed.nests$year), by = 5)) +
scale_y_continuous(limits = c(0,1), labels = scales::percent_format(accuracy = 1)) +
labs(title = "Proportion of Successful Nests per Year",
x = "Year", y = "Success Proportion") +
theme_bw() +
theme(panel.grid = element_blank())
weather_yearly <- WeatherData |>
group_by(YEAR) |>
summarise(
mean_temp   = mean(TEMP, na.rm = TRUE),
max_temp    = max(MAX, na.rm = TRUE),
min_temp    = min(MIN, na.rm = TRUE),
total_rain  = sum(PRCP, na.rm = TRUE),
mean_wind   = mean(WDSP, na.rm = TRUE),
max_wind    = max(MXSPD, na.rm = TRUE),
hail_days   = sum(I_HAIL, na.rm = TRUE),   # number of hail days per year
.groups = "drop"
)
View(weather_yearly)
View(active.nests)
weather_yearly <- weather_data |>
filter(YEAR >= 1992 & YEAR <= 2024) |>
group_by(YEAR) |>
summarise(
mean_temp   = mean(TEMP, na.rm = TRUE),
max_temp    = max(MAX, na.rm = TRUE),
min_temp    = min(MIN, na.rm = TRUE),
total_rain  = sum(PRCP, na.rm = TRUE),
mean_wind   = mean(WDSP, na.rm = TRUE),
max_wind    = max(MXSPD, na.rm = TRUE),
hail_days   = sum(I_HAIL, na.rm = TRUE),   # number of hail days per year
.groups = "drop"
)
weather_yearly <-WeatherData |>
filter(YEAR >= 1992 & YEAR <= 2024) |>
group_by(YEAR) |>
summarise(
mean_temp   = mean(TEMP, na.rm = TRUE),
max_temp    = max(MAX, na.rm = TRUE),
min_temp    = min(MIN, na.rm = TRUE),
total_rain  = sum(PRCP, na.rm = TRUE),
mean_wind   = mean(WDSP, na.rm = TRUE),
max_wind    = max(MXSPD, na.rm = TRUE),
hail_days   = sum(I_HAIL, na.rm = TRUE),   # number of hail days per year
.groups = "drop"
)
View(weather_yearly)
View(failed.nests)
View(active.nests)
effort_weather <- active.nests %>%
left_join(weather_yearly, by = c("year" = "YEAR"))
View(effort_weather)
effort_model_nb <- glm.nb(
active_nests ~ mean_temp + total_rain + mean_wind + hail_days + year,
data = effort_weather
)
libray(MASS)
library(MASS)
effort_model_nb <- glm.nb(
active_nests ~ mean_temp + total_rain + mean_wind + hail_days + year,
data = effort_weather
)
View(effort_model_nb)
summary(effort_model_nb)
weather_yearly_lagged <- weather_yearly %>%
arrange(YEAR) %>%
mutate(
lag_rain = lag(total_rain, 1),   # previous year rainfall
lag_temp = lag(mean_temp, 1),    # previous year mean temp
lag_wind = lag(mean_wind, 1),    # previous year mean wind
lag_hail = lag(hail_days, 1)     # previous year hail days
)
weather_yearly <- weather_yearly %>%
arrange(YEAR) %>%
mutate(
lag_rain = lag(total_rain, 1),   # previous year rainfall
lag_temp = lag(mean_temp, 1),    # previous year mean temp
lag_wind = lag(mean_wind, 1),    # previous year mean wind
lag_hail = lag(hail_days, 1)     # previous year hail days
)
View(weather_yearly)
effort_weather <- active.nests %>%
left_join(weather_yearly, by = c("year" = "YEAR"))
effort_model_nb_lag <- glm.nb(
active_nests ~ mean_temp + total_rain + mean_wind + hail_days +
lag_rain + lag_temp + lag_wind + lag_hail +
year,
data = effort_weather
)
summary(effort_model_nb_lag)
effort_model_nb_lag <- glm.nb(
active_nests ~ lag_rain + lag_temp + lag_wind + lag_hail +
year,
data = effort_weather
)
summary(effort_model_nb_lag)
effort_model_nb_lag <- glm.nb(
active_nests ~ mean_temp + total_rain + mean_wind + hail_days +
lag_rain + lag_temp + lag_wind + lag_hail +
year,
data = effort_weather
)
summary(effort_model_nb_lag)
weather_vars <- effort_weather %>%
select(mean_temp, total_rain, mean_wind, hail_days,
lag_rain, lag_temp, lag_wind, lag_hail, year)
library(dplyr)
weather_vars <- effort_weather %>%
dplyr::select(mean_temp, total_rain, mean_wind, hail_days,
lag_rain, lag_temp, lag_wind, lag_hail, year)
cor_matrix <- cor(weather_vars, use = "pairwise.complete.obs")
round(cor_matrix, 2)
library(dplyr)
weather_vars <- effort_weather %>%
dplyr::select(mean_temp, total_rain, mean_wind, hail_days, year)
cor_matrix <- cor(weather_vars, use = "pairwise.complete.obs")
round(cor_matrix, 2)
library(car)
vif_model <- lm(active_nests ~ mean_temp + total_rain + mean_wind + hail_days + year,
data = effort_weather)
car::vif(vif_model)
weather_vars <- effort_weather %>%
dplyr::select(mean_temp, total_rain, mean_wind, hail_days,
lag_rain, lag_temp, lag_wind, lag_hail, year)
cor_matrix <- cor(weather_vars, use = "pairwise.complete.obs")
round(cor_matrix, 2)
effort_model_nb_lag <- glm.nb(
active_nests ~ mean_temp + total_rain + mean_wind + hail_days +
lag_rain + lag_temp + lag_hail +
year,
data = effort_weather
)
summary(effort_model_nb_lag)
effort_model_nb_lag <- glm.nb(
active_nests ~ lag_rain + lag_temp + lag_wind + lag_hail +
year,
data = effort_weather
)
summary(effort_model_nb_lag)
weather_yearly <- weather_data %>%
filter(YEAR >= 1992 & YEAR <= 2024) %>%
group_by(YEAR) %>%
summarise(
mean_temp   = mean(TEMP, na.rm = TRUE),
max_temp    = max(MAX, na.rm = TRUE),
min_temp    = min(MIN, na.rm = TRUE),
total_rain  = sum(PRCP, na.rm = TRUE),
max_rain    = max(PRCP, na.rm = TRUE),                # biggest rainfall day
rain_days   = sum(PRCP > 0, na.rm = TRUE),            # number of rainy days
mean_wind   = mean(WDSP, na.rm = TRUE),
max_wind    = max(MXSPD, na.rm = TRUE),
hail_days   = sum(I_HAIL, na.rm = TRUE),
.groups = "drop"
)
weather_yearly <- WeatherData %>%
filter(YEAR >= 1992 & YEAR <= 2024) %>%
group_by(YEAR) %>%
summarise(
mean_temp   = mean(TEMP, na.rm = TRUE),
max_temp    = max(MAX, na.rm = TRUE),
min_temp    = min(MIN, na.rm = TRUE),
total_rain  = sum(PRCP, na.rm = TRUE),
max_rain    = max(PRCP, na.rm = TRUE),                # biggest rainfall day
rain_days   = sum(PRCP > 0, na.rm = TRUE),            # number of rainy days
mean_wind   = mean(WDSP, na.rm = TRUE),
max_wind    = max(MXSPD, na.rm = TRUE),
hail_days   = sum(I_HAIL, na.rm = TRUE),
.groups = "drop"
)
# Merge the number of active nests calculates previously to the weather data to create a new data frame.
effort_weather <- active.nests %>%
left_join(weather_yearly, by = c("year" = "YEAR"))
# Negative Binomial model for breeding effort
library(MASS)
effort_model_extremes <- glm.nb(
active_nests ~ mean_temp + max_temp + min_temp +
total_rain + max_rain + rain_days +
mean_wind + max_wind + hail_days + year,
data = effort_weather
)
summary(effort_model_extremes)
library(ggplot2)
# Make new data for prediction
newdat <- data.frame(
mean_temp = mean(effort_weather$mean_temp, na.rm = TRUE),
max_temp  = mean(effort_weather$max_temp, na.rm = TRUE),
min_temp  = mean(effort_weather$min_temp, na.rm = TRUE),
total_rain = mean(effort_weather$total_rain, na.rm = TRUE),
max_rain   = seq(min(effort_weather$max_rain, na.rm = TRUE),
max(effort_weather$max_rain, na.rm = TRUE),
length.out = 100),
rain_days  = mean(effort_weather$rain_days, na.rm = TRUE),
mean_wind  = mean(effort_weather$mean_wind, na.rm = TRUE),
max_wind   = mean(effort_weather$max_wind, na.rm = TRUE),
hail_days  = mean(effort_weather$hail_days, na.rm = TRUE),
year       = mean(effort_weather$year, na.rm = TRUE)
)
# Predict from your fitted model
newdat$pred <- predict(effort_model_extremes, newdata = newdat, type = "response")
ggplot(newdat, aes(x = max_rain, y = pred)) +
geom_line(color="darkblue", size=1.2) +
labs(x = "Maximum daily rainfall (mm)",
y = "Predicted number of active nests",
title = "Effect of extreme rainfall on vulture breeding effort") +
theme_minimal()
ggplot(newdat, aes(x = max_rain, y = pred)) +
geom_line(color="darkblue", size=1.2) +
labs(x = "Maximum daily rainfall (mm)",
y = "Predicted number of active nests",
title = "Effect of extreme rainfall on vulture breeding effort") +
theme_bw()
ggplot(newdat, aes(x = max_rain, y = pred)) +
geom_line(color="darkblue", size=1.2) +
labs(x = "Maximum daily rainfall (mm)",
y = "Predicted number of active nests",
title = "Effect of extreme rainfall on vulture breeding effort") +
theme_bw() +
theme(panel.grid = element_blank())   # removes all gridlines
failed.nests %>%
select(year, success_nests, failed_nests) %>%
pivot_longer(cols = c(success_nests, failed_nests),
names_to = "outcome", values_to = "count") |>
ggplot(aes(x = year, y = count, fill = outcome)) +
geom_col() +
scale_fill_manual(values = c("success_nests" = "#89c5d6",
"failed_nests" = "darkgrey"),
labels = c("Failed", "Successful")) +
scale_x_continuous(breaks = seq(min(failed.nests$year),
max(failed.nests$year), by = 5)) +
labs(title = "Breeding Outcomes per Year",
x = "Year", y = "Number of Nests", fill = "Outcome") +
theme_bw() +
theme(panel.grid = element_blank())
#| message: false
#| warning: false
library(ggpubr)
library(tidyverse)
library(ggplot2)
library(tidyr)
library(dplyr)
library(tidyverse)
library(car)
library(lubridate)
library(janitor)
library(stringr)
library(MASS)
failed.nests %>%
select(year, success_nests, failed_nests) %>%
pivot_longer(cols = c(success_nests, failed_nests),
names_to = "outcome", values_to = "count") |>
ggplot(aes(x = year, y = count, fill = outcome)) +
geom_col() +
scale_fill_manual(values = c("success_nests" = "#89c5d6",
"failed_nests" = "darkgrey"),
labels = c("Failed", "Successful")) +
scale_x_continuous(breaks = seq(min(failed.nests$year),
max(failed.nests$year), by = 5)) +
labs(title = "Breeding Outcomes per Year",
x = "Year", y = "Number of Nests", fill = "Outcome") +
theme_bw() +
theme(panel.grid = element_blank())
failed.nests <- vultures.clean |>
mutate(ringing.date = ymd(gsub("/", "-", as.character(ringing.date)))) |>
filter(!is.na(ringing.date)) |>
mutate(year = year(ringing.date)) |>
group_by(year) |>
summarise(
active_nests   = n(),
success_nests  = sum(!is.na(laying.date) & laying.date != "0" & laying.date != ""),
failed_nests   = active_nests - success_nests,
success_prop   = success_nests / active_nests,
.groups = "drop"
)
head(failed.nests)
all(failed.nests$active_nests ==
failed.nests$success_nests + failed.nests$failed_nests)
install.packages("styler")
styler::style_file("VultureProject.qmd")
#| message: false
#| warning: false
failed.nests %>%
select(year, success_nests, failed_nests) %>%
pivot_longer(
cols = c(success_nests, failed_nests),
names_to = "outcome", values_to = "count"
) |>
ggplot(aes(x = year, y = count, fill = outcome)) +
geom_col() +
scale_fill_manual(
values = c(
"success_nests" = "#89c5d6",
"failed_nests" = "darkgrey"
),
labels = c("Failed", "Successful")
) +
scale_x_continuous(breaks = seq(min(failed.nests$year),
max(failed.nests$year),
by = 5
)) +
labs(
title = "Breeding Outcomes per Year",
x = "Year", y = "Number of Nests", fill = "Outcome"
) +
theme_bw() +
theme(panel.grid = element_blank())
failed_nests_long <- failed.nests %>%
dplyr::select(year, success_nests, failed_nests) %>%   # <- force dplyr's select
tidyr::pivot_longer(
cols = c(success_nests, failed_nests),
names_to = "outcome",
values_to = "count"
)
ggplot(failed_nests_long, aes(x = year, y = count, fill = outcome)) +
geom_col() +
scale_fill_manual(
values = c("success_nests" = "#89c5d6", "failed_nests" = "darkgrey"),
labels = c("success_nests" = "Successful", "failed_nests" = "Failed")
) +
scale_x_continuous(
breaks = seq(min(failed.nests$year, na.rm = TRUE),
max(failed.nests$year, na.rm = TRUE),
by = 5)
) +
labs(
title = "Breeding Outcomes per Year",
x = "Year", y = "Number of Nests", fill = "Outcome"
) +
theme_bw() +
theme(panel.grid = element_blank())
