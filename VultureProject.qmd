---
title: "The Effects of Climate Change on the Breeding Success and Timing of African White Backed Vultures."
author: "Mieke Deyzel"
output: html_document
date: ""
format:
  html:
    embed-resources: true
---

::: {.panel-tabset}

## Clean Data 

### Aim and Objectives 

The project aims to investigate how weather variation affects the breeding timing and success of African White Backed Vultures over 31 years. To address this, three broad objectives and sub-questions were identified:

To determine whether annual variation in climatic conditions is associated with breeding effort
Is the total number of active nests (both failed and successful) each year associated with variation in weather conditions?
We hypothesise that variation in climatic conditions will influence the number of active nests observed annually. In years with significant fluctuations in weather events and climatic extremes, there will be a lower number of active nests. 

To determine whether climatic conditions predict variation in yearly breeding success
Is annual variation in weather associated with breeding success, measured as the proportion of active nests that produce a fledgling?
We hypothesise that annual variation in climatic conditions will influence the proportion of successful nests per annum. Moderate fluctuations in climatic conditions and the absence of extreme weather events such as hailstorms will increase the proportion of successful breeding, leading to more annual fledglings. 

To assess whether climatic conditions predict the timing of breeding
Is the timing of fledging associated with climatic conditions during the breeding season?
We hypothesise that the time of fledging will be correlated with the annual variation in climatic conditions. Preferred weather conditions, such as moderate temperatures, will result in earlier breeding of the vultures compared to more extreme conditions. 


#### Load in libraries
```{r}

#| message: false
#| warning: false
library(tidyverse)  
library(lubridate)
library(janitor)
library(stringr)
library(car)         # Durbin–Watson
library(MASS)        # glm.nb
library(patchwork)   

theme_set(theme_bw())

```

### Load in Breeding and Weather Data

```{r}
vultures <- read.csv("~/Desktop/Vulture Project/Data/93_24 cleaned.csv")
WeatherData <- read.csv("~/Desktop/Vulture Project/Data/Weather.csv")
```



```{r}
#| message: false
#| warning: false
# Clean names, standardise separators
vultures <- vultures |>
  clean_names() |>
  rename_with(~ gsub("_", ".", .x))

# Dates
vultures <- vultures |>
  mutate(
    ringing.date = ymd(gsub("/", "-", ringing.date)),
    laying.date  = laying.date |> as.character() |> str_trim(),
    laying.date  = if_else(laying.date %in% c("", "NA", "?"), NA_character_, laying.date),
    laying.date  = ymd(gsub("/", "-", laying.date))
  )

# Keep records with a real ringing date
vultures.clean <- vultures |>
  filter(!is.na(ringing.date))


```

Weather summaries (annual & daily)

```{r}
# Annual summaries for joining to yearly analyses (Obj.1 & Obj.2)
weather_yearly <- WeatherData |>
  filter(YEAR >= 1992, YEAR <= 2024) |>
  group_by(YEAR) |>
  summarise(
    mean_temp  = mean(TEMP, na.rm = TRUE),
    max_temp   = max(MAX,  na.rm = TRUE),
    min_temp   = min(MIN,  na.rm = TRUE),
    total_rain = sum(PRCP, na.rm = TRUE),
    max_rain   = max(PRCP, na.rm = TRUE),              # wettest day
    rain_days  = sum(PRCP > 0, na.rm = TRUE),          # count of rainy days
    mean_wind  = mean(WDSP, na.rm = TRUE),
    max_wind   = max(MXSPD, na.rm = TRUE),
    hail_days  = sum(I_HAIL, na.rm = TRUE),
    .groups = "drop"
  )

# Lagged versions of the annual weather summaries
weather_yearly_lag <- weather_yearly |> 
  arrange(YEAR) |> 
  mutate(
    across(c(mean_temp, max_temp, min_temp, total_rain, max_rain,
             rain_days, mean_wind, max_wind, hail_days),
           ~ dplyr::lag(.x, 1), .names = "lag_{.col}")
  )


# Daily table for pre-laying windows (Obj.3)
weather_df <- WeatherData |>
  mutate(
    date      = make_date(YEAR, MONTH, DAY),
    mean_temp = readr::parse_number(as.character(TEMP)),
    max_temp  = readr::parse_number(as.character(MAX)),
    min_temp  = readr::parse_number(as.character(MIN)),
    mean_wind = readr::parse_number(as.character(WDSP)),
    max_wind  = readr::parse_number(as.character(MXSPD)),
    rain      = readr::parse_number(as.character(PRCP)),
    rain_day  = as.integer(replace_na(rain, 0) > 0)
  ) |>
  arrange(date)

```

## Objective 1: Breeding effort (active nests)
```{r}
# Annual active nests
active.nests <- vultures.clean |>
  mutate(year = year(ringing.date)) |>
  group_by(year) |>
  summarise(active_nests = n(), .groups = "drop")

# Join weather to effort
effort_weather <- active.nests |>
  left_join(weather_yearly, by = c("year" = "YEAR"))

# Visual
ggplot(active.nests, aes(year, active_nests)) +
  geom_col(fill = "#89c5d6", alpha = 0.85) +
  geom_smooth(method = "lm", se = TRUE, colour = "grey30", linewidth = 1) +
  scale_x_continuous(breaks = seq(min(active.nests$year), max(active.nests$year), 5)) +
  labs(title = "Active nests per year", x = "Year", y = "Active nests")

```

```{r}
failed.nests <- vultures.clean |>
  mutate(year = year(ringing.date)) |>
  group_by(year) |>
  summarise(
    active_nests  = n(),
    success_nests = sum(!is.na(laying.date)),
    failed_nests  = active_nests - success_nests,
    success_prop  = success_nests / active_nests,
    .groups = "drop"
  )
ggplot(failed.nests, aes(x = year, y = success_prop)) +
  geom_line(color = "#89c5d6", linewidth = 1) +
  geom_point(color = "#89c5d6") +
  scale_x_continuous(breaks = seq(min(failed.nests$year), max(failed.nests$year), by = 5)) +
  scale_y_continuous(limits = c(0, 1),
                     labels = scales::percent_format(accuracy = 1)) +
  labs(title = "Proportion of Successful Nests per Year", x = "Year", y = "Success Proportion") +
  theme_bw() +
  theme(panel.grid = element_blank())
```

### Negative Binomial GLM

```{r}
# Negative Binomial GLM 
effort_model <- glm.nb(
  active_nests ~ mean_temp + max_temp + min_temp +
    total_rain + max_rain + rain_days + mean_wind + max_wind + hail_days + year,
  data = effort_weather
)
summary(effort_model)

logLik(effort_model)

```
### Lagged effects 
```{r}
# Join active nests with lagged weather
effort_weather_lag <- active.nests |> 
  left_join(weather_yearly_lag, by = c("year" = "YEAR"))

# Minimal, stable lag model (adds year to control for trend)
effort_nb_lag <- MASS::glm.nb(
  active_nests ~ lag_total_rain + lag_mean_temp + lag_mean_wind + lag_hail_days + year,
  data = effort_weather_lag,
  control = glm.control(maxit = 100), init.theta = 1
)
summary(effort_nb_lag)

# Compare to current-year model by AIC
AIC(effort_model, effort_nb_lag)

```

## Objective 2: Breeding success (proportion)

```{r}
# Annual successes/failures
failed.nests <- vultures.clean |>
  mutate(year = year(ringing.date)) |>
  group_by(year) |>
  summarise(
    active_nests  = n(),
    success_nests = sum(!is.na(laying.date)),
    failed_nests  = active_nests - success_nests,
    success_prop  = success_nests / active_nests,
    .groups = "drop"
  )

# Outcome visual
failed_nests_long <- failed.nests |>
  dplyr::select(year, success_nests, failed_nests) |>
  tidyr::pivot_longer(
    cols = c(success_nests, failed_nests),
    names_to = "outcome",
    values_to = "count"
  )

ggplot(failed_nests_long, aes(year, count, fill = outcome)) +
  geom_col() +
  scale_fill_manual(values = c(success_nests = "#89c5d6", failed_nests = "grey70"),
                    labels = c(success_nests = "Successful", failed_nests = "Failed")) +
  scale_x_continuous(breaks = seq(min(failed.nests$year), max(failed.nests$year), 5)) +
  labs(title = "Breeding outcomes per year", x = "Year", y = "Number of nests", fill = "Outcome")

```
```{r}
# Join weather; scale predictors for stability
success_df <- failed.nests |>
  left_join(weather_yearly, by = c("year" = "YEAR")) |>
  mutate(
    across(c(mean_temp, max_temp, min_temp, total_rain, max_rain,
             rain_days, mean_wind, max_wind, hail_days),
           ~ as.numeric(scale(.x)), .names = "z_{.col}")
  )

# Quasi-binomial GLM (handles overdispersion)
success_model_quasi <- glm(
  cbind(success_nests, failed_nests) ~
    z_mean_temp + z_max_temp + z_min_temp +
    z_total_rain + z_max_rain + z_rain_days +
    z_mean_wind + z_max_wind + z_hail_days + year,
  family = quasibinomial,
  data = success_df
)
summary(success_model_quasi)

```

```{r}
# Effect of minimum temperature (holding others at 0)
newdat_minT <- tibble(
  z_min_temp  = seq(min(success_df$z_min_temp, na.rm = TRUE),
                    max(success_df$z_min_temp, na.rm = TRUE), length.out = 200),
  z_mean_temp = 0, z_max_temp = 0, z_total_rain = 0, z_max_rain = 0,
  z_rain_days = 0, z_mean_wind = 0, z_max_wind = 0, z_hail_days = 0,
  year = mean(success_df$year, na.rm = TRUE)
)

pred <- predict(success_model_quasi, newdata = newdat_minT, type = "link", se.fit = TRUE)
newdat_minT <- newdat_minT |>
  mutate(p = plogis(pred$fit),
         lwr = plogis(pred$fit - 1.96*pred$se.fit),
         upr = plogis(pred$fit + 1.96*pred$se.fit))

plot_minT <- ggplot(newdat_minT, aes(z_min_temp, p)) +
  geom_ribbon(aes(ymin = lwr, ymax = upr), alpha = 0.15) +
  geom_line(linewidth = 1.2, colour = "#2C7BB6") +
  labs(x = "Minimum temperature (scaled)", y = "Predicted breeding success",
       title = "Effect of warmer nights on breeding success")

```

```{r}
# Long-term trend in success
newdat_year <- tibble(
  year = seq(min(success_df$year), max(success_df$year), length.out = 200),
  z_mean_temp = 0, z_max_temp = 0, z_min_temp = 0, z_total_rain = 0, z_max_rain = 0,
  z_rain_days = 0, z_mean_wind = 0, z_max_wind = 0, z_hail_days = 0
)

pred_year <- predict(success_model_quasi, newdata = newdat_year, type = "link", se.fit = TRUE)
newdat_year <- newdat_year |>
  mutate(p = plogis(pred_year$fit),
         lwr = plogis(pred_year$fit - 1.96*pred_year$se.fit),
         upr = plogis(pred_year$fit + 1.96*pred_year$se.fit))

plot_year <- ggplot(newdat_year, aes(year, p)) +
  geom_ribbon(aes(ymin = lwr, ymax = upr), alpha = 0.15) +
  geom_line(linewidth = 1.2, colour = "#D7191C") +
  labs(x = "Year", y = "Predicted breeding success",
       title = "Long-term trend in breeding success")

# Side-by-side
(plot_minT | plot_year) + plot_annotation(title = "Drivers of breeding success", tag_levels = "A")

```

### Lagged weather effects 
```{r}
# Join successes with lagged weathers
success_df_lag <- failed.nests |> 
  left_join(weather_yearly_lag, by = c("year" = "YEAR")) |> 
  mutate(
    across(c(lag_mean_temp, lag_max_temp, lag_min_temp, lag_total_rain, lag_max_rain,
             lag_rain_days, lag_mean_wind, lag_max_wind, lag_hail_days),
           ~ as.numeric(scale(.x)), .names = "z_{.col}")
  )

success_lag_quasi <- glm(
  cbind(success_nests, failed_nests) ~
    z_lag_mean_temp + z_lag_min_temp + z_lag_max_temp +
    z_lag_total_rain + z_lag_max_rain + z_lag_rain_days +
    z_lag_mean_wind + z_lag_max_wind + z_lag_hail_days +
    year,
  family = quasibinomial,
  data = success_df_lag
)
summary(success_lag_quasi)

# (Tip) Quasi-binomial has no AIC; judge by effect sizes, SEs, and residual deviance/df.
disp_ratio_lag <- deviance(success_lag_quasi) / df.residual(success_lag_quasi)
disp_ratio_lag

```


## Objective 3: Breeding timing (laying date)

```{r}
# Per-record timing
timing_df <- vultures.clean |>
  filter(!is.na(laying.date)) |>
  mutate(
    lay_DOY = yday(laying.date),
    year    = year(laying.date)
  )

# Histogram
ggplot(timing_df, aes(lay_DOY)) +
  geom_histogram(binwidth = 5, colour = "black", fill = "grey80") +
  labs(title = "Distribution of laying dates (all years)",
       x = "Laying date (day of year)", y = "Count")

```

```{r}
# Annual means ± SE (showing 1990–2025 frame)
annual_timing <- timing_df |>
  group_by(year) |>
  summarise(
    n = n(),
    mean_DOY = mean(lay_DOY, na.rm = TRUE),
    se_DOY   = sd(lay_DOY, na.rm = TRUE) / sqrt(n),
    .groups = "drop"
  )

full_years <- tibble(year = 1990:2025)
annual_timing_full <- full_years |> left_join(annual_timing, by = "year")

ggplot(annual_timing_full, aes(year, mean_DOY)) +
  geom_point(na.rm = TRUE) +
  geom_errorbar(aes(ymin = mean_DOY - se_DOY, ymax = mean_DOY + se_DOY),
                width = 0, na.rm = TRUE) +
  geom_smooth(method = "lm", se = TRUE, colour = "black", na.rm = TRUE) +
  scale_x_continuous(breaks = seq(1990, 2025, 5), limits = c(1990, 2025)) +
  labs(title = "Annual trend in laying dates (1990–2025)",
       x = "Year", y = "Mean laying date (DOY ± SE)")

```

```{r}
# Full annual-weather timing model (screening)
timing_weather <- timing_df |>
  left_join(weather_yearly, by = c("year" = "YEAR"))

timing_weather_full <- lm(
  lay_DOY ~ mean_temp + max_temp + min_temp +
    total_rain + max_rain + rain_days + mean_wind + max_wind + hail_days + year,
  data = timing_weather
)
summary(timing_weather_full)

# Simplified (best annual terms)
timing_weather_simple <- lm(lay_DOY ~ rain_days + max_wind + year, data = timing_weather)
summary(timing_weather_simple)

```

```{r}
# 60-day pre-laying windows (daily weather)
summarise_60 <- function(lay_date, weather) {
  w <- weather |> filter(date > (lay_date - days(60)), date <= lay_date)
  tibble(
    mean_temp_60  = mean(w$mean_temp, na.rm = TRUE),
    max_temp_60   = mean(w$max_temp,  na.rm = TRUE),
    min_temp_60   = mean(w$min_temp,  na.rm = TRUE),
    total_rain_60 = sum(w$rain,       na.rm = TRUE),
    rain_days_60  = sum(w$rain_day,   na.rm = TRUE),
    mean_wind_60  = mean(w$mean_wind, na.rm = TRUE),
    max_wind_60   = mean(w$max_wind,  na.rm = TRUE)
  )
}

timing_weather_60 <- timing_df |>
  mutate(.win = purrr::map(laying.date, summarise_60, weather = weather_df)) |>
  unnest(.win)

timing_weather_60_model <- lm(lay_DOY ~ rain_days_60 + max_wind_60 + year, data = timing_weather_60)
summary(timing_weather_60_model)

```

```{r}
# Plot predicted effect of rainy days (60-day window)
new_rain60 <- tibble(
  rain_days_60 = seq(min(timing_weather_60$rain_days_60, na.rm = TRUE),
                     max(timing_weather_60$rain_days_60, na.rm = TRUE), length.out = 100),
  max_wind_60  = mean(timing_weather_60$max_wind_60, na.rm = TRUE),
  year         = mean(timing_weather_60$year, na.rm = TRUE)
)

pred <- predict(timing_weather_60_model, newdata = new_rain60, se.fit = TRUE)
new_rain60 <- new_rain60 |>
  mutate(fit = pred$fit, lwr = pred$fit - 1.96*pred$se.fit, upr = pred$fit + 1.96*pred$se.fit)

ggplot() +
  geom_point(data = timing_weather_60, aes(rain_days_60, lay_DOY), alpha = 0.3, size = 1) +
  geom_line(data = new_rain60, aes(rain_days_60, fit), colour = "black", linewidth = 1) +
  geom_ribbon(data = new_rain60, aes(rain_days_60, ymin = lwr, ymax = upr), fill = "grey80", alpha = 0.4) +
  labs(title = "Effect of 60-day pre-laying rainfall on laying date",
       x = "Rainy days in the 60 days before laying", y = "Predicted laying date (DOY)")

```

## Autocorrelation checks (residual independence)

```{r}
# Obj.1 Effort (NB GLM)
car::durbinWatsonTest(effort_model)
acf(resid(effort_model), main = "ACF: Effort residuals")
pacf(resid(effort_model), main = "PACF: Effort residuals")

# Obj.2 Success (quasi-binomial GLM)
car::durbinWatsonTest(success_model_quasi)
acf(resid(success_model_quasi), main = "ACF: Success residuals")
pacf(resid(success_model_quasi), main = "PACF: Success residuals")

# Obj.3 Timing — raw annual series (detrend & test)
annual_timing_clean <- timing_df |>
  group_by(year) |>
  summarise(mean_DOY = mean(lay_DOY, na.rm = TRUE), .groups = "drop") |>
  filter(!is.na(mean_DOY)) |>
  arrange(year)

timing_lm <- lm(mean_DOY ~ year, data = annual_timing_clean)
car::durbinWatsonTest(timing_lm)
acf(resid(timing_lm), main = "ACF: Timing residuals")
pacf(resid(timing_lm), main = "PACF: Timing residuals")

# Obj.3 Timing — 60-day model residuals
car::durbinWatsonTest(timing_weather_60_model)
acf(resid(timing_weather_60_model), main = "ACF: Timing(60d) residuals")
pacf(resid(timing_weather_60_model), main = "PACF: Timing(60d) residuals")

```



## Attempt 2
## Objective 1
### Year 

```{r}
library(MASS)

# Annual active nests (you already have this)
active.nests <- vultures.clean |>
  mutate(year = lubridate::year(ringing.date)) |>
  group_by(year) |>
  summarise(active_nests = n(), .groups = "drop")

# Year-only Negative Binomial model
m_year <- glm.nb(active_nests ~ year, data = active.nests)
summary(m_year)

# Plot with fitted line
active.nests$fit_year <- fitted(m_year)

ggplot(active.nests, aes(x = year, y = active_nests)) +
  geom_col(fill = "#89c5d6", alpha = 0.85) +
  geom_line(aes(y = fit_year), linewidth = 1) +
  labs(
    title = "Active nests per year (with Year-only trend)",
    x = "Year",
    y = "Number of active nests"
  ) +
  theme_bw() +
  theme(panel.grid = element_blank())

```

### Rainfall 

```{r}
library(dplyr)

effort_weather <- active.nests |>
  left_join(weather_yearly, by = c("year" = "YEAR")) |>
  mutate(
    z_total_rain = scale(total_rain),
    z_max_rain   = scale(max_rain),
    z_rain_days  = scale(rain_days)
  )

m_rain_only <- MASS::glm.nb(
  active_nests ~ z_total_rain + z_max_rain + z_rain_days,
  data = effort_weather
)
summary(m_rain_only)


```

### Temperature

```{r}
effort_weather <- effort_weather |>
  mutate(
    z_mean_temp = scale(mean_temp),
    z_max_temp  = scale(max_temp),
    z_min_temp  = scale(min_temp)
  )

m_temp_only <- MASS::glm.nb(
  active_nests ~z_mean_temp+ z_max_temp + z_min_temp,
  data = effort_weather
)
summary(m_temp_only)

```
Annual breeding effort increased significantly with maximum temperature (β = 0.132 ± 0.059 SE, p = 0.025). Years with higher extreme temperatures had more active nests, whereas mean and minimum temperature showed no significant relationships. The model explained slightly more variation than rainfall-based models (AIC = 297.8 vs. 299.5).

### Wind 

```{r}
effort_weather <- effort_weather |>
  mutate(
    z_mean_wind = scale(mean_wind),
    z_max_wind  = scale(max_wind),
    z_hail_days = scale(hail_days)
  )

m_wind_only <- MASS::glm.nb(
  active_nests ~ z_mean_wind + z_max_wind,
  data = effort_weather
)
summary(m_wind_only)

```
Annual mean and maximum wind speeds were not significantly related to the number of active nests (p > 0.1 for both variables). The wind-based model (AIC = 297.4) provided no improvement over temperature or rainfall models, suggesting that wind intensity plays little role in determining overall breeding effort.

### Hail 

```{r}
effort_weather <- effort_weather |>
  mutate(
    z_mean_wind = scale(mean_wind),
    z_max_wind  = scale(max_wind),
    z_hail_days = scale(hail_days)
  )

m_hail_only <- MASS::glm.nb(
  active_nests ~z_hail_days,
  data = effort_weather
)
summary(m_hail_only)

```

The number of active nests increased significantly with annual hail frequency (β = 0.097 ± 0.049 SE, p = 0.049). Years experiencing more hail days showed roughly a 10 % increase in active nests. Models based on temperature and rainfall alone did not show significant relationships, and the hail-day model achieved the lowest AIC (295.3), suggesting that rare extreme-weather events may coincide with greater breeding effort.

Annual breeding effort of African White-backed Vultures increased significantly with maximum temperature and with the number of hail days. The rainfall block showed no significant relationships. The best-supported model (lowest AIC = 295.3) included hail days, suggesting that years with more storm activity tended to have greater nesting effort. These relationships likely reflect indirect climatic influences—hotter and stormier years may coincide with improved food availability or with overall population recovery—rather than a direct causal effect of weather on nesting initiation.

### Checking fro correlation
```{r}
cor(effort_weather[, c("year","hail_days","max_temp")], use="pairwise.complete.obs")

```
```{r}
ggplot(data.frame(fit=fitted(m_wind_only), obs=effort_weather$active_nests),
       aes(fit, obs)) + geom_point() + geom_smooth(method="lm", se=FALSE)

```
Both maximum temperature and hail frequency increased modestly through time (r ≈ 0.3–0.4), suggesting that their apparent positive effects on breeding effort may in part reflect the underlying temporal recovery of the vulture population rather than a direct climatic driver.

## Objective 2

```{r}
library(dplyr)
library(lubridate)

failed.nests <- vultures.clean |>
  mutate(year = year(ringing.date)) |>
  group_by(year) |>
  summarise(
    active_nests  = n(),
    success_nests = sum(!is.na(laying.date)),      # successful = those with a laying date
    failed_nests  = active_nests - success_nests,
    success_prop  = success_nests / active_nests,
    .groups = "drop"
  )

ggplot(failed.nests, aes(year, success_prop)) +
  geom_line(color = "#89c5d6", linewidth = 1) +
  geom_point(color = "#89c5d6") +
  scale_y_continuous(limits = c(0, 1),
                     labels = scales::percent_format(accuracy = 1)) +
  labs(title = "Proportion of Successful Nests per Year",
       x = "Year", y = "Breeding success (%)") +
  theme_bw() +
  theme(panel.grid = element_blank())

```
### Year only 

```{r}
m_success_year <- glm(
  cbind(success_nests, failed_nests) ~ year,
  family = binomial,
  data = failed.nests
)
summary(m_success_year)

```

#### Check for overdispersion

```{r}
disp_ratio <- deviance(m_success_year) / df.residual(m_success_year)
disp_ratio

```
(was overdispersed so fitting qausi)

```{r}
m_success_year <- glm(
  cbind(success_nests, failed_nests) ~ year,
  family = quasibinomial,
  data = failed.nests
)
summary(m_success_year)

```
Breeding success of African White-backed Vultures declined significantly between 1993 and 2024 (β = −0.022 ± 0.007 SE, t = −3.13, p = 0.004). This corresponds to an average 2 % annual decrease in the odds of producing a fledgling, equivalent to nearly a 50 % decline in success over the 31-year period.

### Rainfall 

```{r}
success_df <- failed.nests |>
  left_join(weather_yearly, by = c("year" = "YEAR")) |>
  mutate(
    z_total_rain = scale(total_rain),
    z_max_rain   = scale(max_rain),
    z_rain_days  = scale(rain_days)
  )

```

```{r}
m_success_rain <- glm(
  cbind(success_nests, failed_nests) ~ 
    z_total_rain + z_max_rain + z_rain_days,
  family = quasibinomial,
  data = success_df
)
summary(m_success_rain)

```

Annual breeding success showed no relationship with rainfall variables. Neither total annual precipitation, maximum daily rainfall, nor the number of rainy days explained variation in the proportion of successful nests (all p > 0.6). The rainfall model accounted for little additional deviance relative to the null model.

### Temperature

```{r}
success_df <- success_df |>
  mutate(
    z_mean_temp = scale(mean_temp),
    z_max_temp  = scale(max_temp),
    z_min_temp  = scale(min_temp)
  )

```

```{r}

m_success_temp <- glm(
  cbind(success_nests, failed_nests) ~ 
z_min_temp,
  family = quasibinomial,
  data = success_df
)
summary(m_success_temp)

```

```{r}
m_success_temp <- glm(
  cbind(success_nests, failed_nests) ~ 
   z_max_temp,
  family = quasibinomial,
  data = success_df
)
summary(m_success_temp)

```

```{r}
 m_success_temp <- glm(
  cbind(success_nests, failed_nests) ~ 
    z_mean_temp,
  family = quasibinomial,
  data = success_df
)
summary(m_success_temp)

```
Minimum temperature showed a significant positive relationship with breeding success (β = 0.161 ± 0.073 SE, p = 0.036). Years with warmer minimum (night-time) temperatures had higher proportions of successful nests, suggesting that milder conditions during the breeding season may improve chick survival.
Neither mean nor maximum temperature showed significant effects (both p > 0.3). These results indicate that low overnight temperatures, rather than daytime heat extremes, are more influential in determining annual breeding success.

### Wind 

```{r}
success_df <- success_df |>
  mutate(
    z_mean_wind = scale(mean_wind),
    z_max_wind  = scale(max_wind),
    z_hail_days = scale(hail_days)
  )

```

```{r}
m_success_wind <- glm(
  cbind(success_nests, failed_nests) ~ 
    z_mean_wind + z_max_wind,
  family = quasibinomial,
  data = success_df
)
summary(m_success_wind)

```

### Hail

```{r}
m_success_hail<- glm(
  cbind(success_nests, failed_nests) ~ 
    z_hail_days,
  family = quasibinomial,
  data = success_df
)
summary(m_success_hail)

```

Neither wind speed nor hail frequency showed a significant relationship with breeding success. Both mean and maximum wind speeds had negligible effects (p > 0.8), and the number of hail days was also unrelated to success (p = 0.38). These findings suggest that annual variation in wind intensity and storm activity does not strongly influence the proportion of successful nests.


## Objective 3

```{r}

timing_df <- vultures.clean |>
  filter(!is.na(laying.date)) |>
  mutate(
    year    = year(laying.date),
    lay_DOY = yday(laying.date)
  )

```

```{r}
ggplot(timing_df, aes(year, lay_DOY)) +
  geom_point(alpha = 0.6) +
  geom_smooth(method = "lm", se = TRUE, colour = "#89c5d6") +
  labs(title = "Annual laying dates of African White-backed Vultures (1993–2024)",
       x = "Year", y = "Laying date (day of year)") +
  theme_bw() +
  theme(panel.grid = element_blank())

```
### Year only 
```{r}
m_timing_year <- lm(lay_DOY ~ year, data = timing_df)
summary(m_timing_year)

```

Laying dates did not change significantly between 1993 and 2024 (β = 0.051 ± 0.050 SE, p = 0.31). The slope indicates a very slight shift toward later laying (about 0.05 days per year, or roughly 1.5 days over three decades), but this trend is negligible and statistically non-significant (R² < 0.001). Overall, laying timing appears stable through time.

### Rainfall 
```{r}
timing_weather <- timing_df |>
  left_join(weather_yearly, by = c("year" = "YEAR")) |>
  mutate(
    z_total_rain = scale(total_rain),
    z_max_rain   = scale(max_rain),
    z_rain_days  = scale(rain_days)
  )

```

```{r}
m_timing_rain <- lm(
  lay_DOY ~ z_total_rain + z_max_rain + z_rain_days,
  data = timing_weather
)
summary(m_timing_rain)

```
Annual rainfall showed no significant effect on the timing of laying (F(3,1423) = 1.81, p = 0.14). Although wetter years tended to correspond weakly with slightly later laying (β_total_rain = +1.27, p = 0.07) and more rainy days with earlier laying (β_rain_days = −0.87, p = 0.09), neither effect was statistically significant. Overall, rainfall explained less than 0.5% of the variation in laying dates (R² = 0.004), indicating that breeding timing remained stable regardless of annual rainfall conditions.

### Temperature 
```{r}
timing_weather <- timing_weather |>
  mutate(
    z_mean_temp = scale(mean_temp),
    z_max_temp  = scale(max_temp),
    z_min_temp  = scale(min_temp)
  )

```

```{r}
m_timing_temp <- lm(
  lay_DOY ~ z_mean_temp + z_max_temp + z_min_temp,
  data = timing_weather
)
summary(m_timing_temp)

```
Minimum temperature showed a significant negative relationship with laying date (β = –1.32 ± 0.49 SE, p = 0.008), indicating that vultures bred earlier in years with warmer nights. Mean and maximum temperature had no effect (p > 0.6). Overall, the model explained little of the total variation (R² = 0.005), but the direction of the effect suggests that milder nocturnal conditions may trigger earlier laying.

### Wind 
```{r}
timing_weather <- timing_weather |>
  mutate(
    z_mean_wind = scale(mean_wind),
    z_max_wind  = scale(max_wind),
    z_hail_days = scale(hail_days)
  )

```

```{r}
m_timing_wind <- lm(
  lay_DOY ~ z_mean_wind + z_max_wind,
  data = timing_weather
)
summary(m_timing_wind)

```
Maximum wind speed had a significant positive relationship with laying date (β = +1.32 ± 0.48 SE, p = 0.006), indicating that vultures tended to lay later in windier years. Mean wind speed showed no effect (p = 0.13). Although wind explained less than 1 % of the total variation in laying dates (R² = 0.009), the direction of the effect suggests that stronger winds may delay breeding, potentially by reducing flight efficiency or nest stability during the early season.


### Hail 


```{r}
m_timing_hail <- lm(
  lay_DOY ~ z_hail_days,
  data = timing_weather
)
summary(m_timing_hail)

```
The number of hail days showed a significant negative relationship with laying date (β = –0.97 ± 0.47 SE, p = 0.038). Vultures laid earlier in years with more hail events, suggesting that stormier seasons may coincide with conditions prompting earlier breeding. Although the overall effect size was small (R² = 0.003), this pattern supports the idea that extreme-weather activity may influence breeding timing.

Summary of results 

```{r}
library(tibble)
library(dplyr)
library(knitr)

sig_summary <- tribble(
  ~Objective,               ~Response,                         ~Predictor,          ~Direction,        ~p_value, ~Interpretation,
  "1. Breeding effort",     "Active nests (NB GLM)",           "Max temperature",   "Positive (↑)",    0.025,   "More active nests in hotter years.",
  "1. Breeding effort",     "Active nests (NB GLM)",           "Hail days",         "Positive (↑)",    0.049,   "More active nests in years with more hail.",
  "2. Breeding success",    "Success proportion (quasi-bin)",  "Min temperature",   "Positive (↑)",    0.036,   "Higher success in warmer nights.",
  "3. Breeding timing",     "Laying date DOY (LM)",            "Min temperature",   "Negative (↓)",    0.008,   "Warmer nights → earlier laying.",
  "3. Breeding timing",     "Laying date DOY (LM)",            "Max wind speed",    "Positive (↑)",    0.006,   "Windier years → later laying.",
  "3. Breeding timing",     "Laying date DOY (LM)",            "Hail days",         "Negative (↓)",    0.038,   "More hail → earlier laying."
)

kable(sig_summary, align = "l")

```

## Lagged effects 

## Objective 1

```{r}
effort_lag <- active.nests %>%
  left_join(weather_yearly_lag, by = c("year" = "YEAR")) %>%
  mutate(
    z_lag_mean_temp = scale(lag_mean_temp),
    z_lag_max_temp  = scale(lag_max_temp),
    z_lag_min_temp  = scale(lag_min_temp),
    z_lag_total_rain= scale(lag_total_rain),
    z_lag_max_rain  = scale(lag_max_rain),
    z_lag_rain_days = scale(lag_rain_days),
    z_lag_mean_wind = scale(lag_mean_wind),
    z_lag_max_wind  = scale(lag_max_wind),
    z_lag_hail_days = scale(lag_hail_days)
  )
```

### Temperature 
```{r}
m1_eff_temp_lag <- glm.nb(active_nests ~ z_lag_mean_temp + z_lag_max_temp + z_lag_min_temp,
                          data = effort_lag)
summary(m1_eff_temp_lag)
```

### Rainfall 
```{r}
m1_eff_rain_lag <- glm.nb(active_nests ~ z_lag_total_rain + z_lag_max_rain + 
                            z_lag_rain_days,
                          data = effort_lag)
summary(m1_eff_rain_lag)
```
Wind and Hail 

```{r}
m1_eff_wind_lag <- glm.nb(active_nests ~ z_lag_mean_wind + z_lag_max_wind + 
                            z_lag_hail_days,
                          data = effort_lag)
summary(m1_eff_wind_lag)
```


## Objective 2

```{r}
success_lag <- failed.nests %>%
  left_join(weather_yearly_lag, by = c("year" = "YEAR")) %>%
  mutate(
    z_lag_mean_temp = scale(lag_mean_temp),
    z_lag_max_temp  = scale(lag_max_temp),
    z_lag_min_temp  = scale(lag_min_temp),
    z_lag_total_rain= scale(lag_total_rain),
    z_lag_max_rain  = scale(lag_max_rain),
    z_lag_rain_days = scale(lag_rain_days),
    z_lag_mean_wind = scale(lag_mean_wind),
    z_lag_max_wind  = scale(lag_max_wind),
    z_lag_hail_days = scale(lag_hail_days)
  )
```

### Temperature 

```{r}
m2_succ_temp_lag <- glm(
  cbind(success_nests, failed_nests) ~ z_lag_mean_temp + z_lag_max_temp + z_lag_min_temp,
  family = quasibinomial, data = success_lag
)
summary(m2_succ_temp_lag)

```

### Rainfall

```{r}
m2_succ_rain_lag <- glm(
  cbind(success_nests, failed_nests) ~ z_lag_total_rain + z_lag_max_rain + z_lag_rain_days,
  family = quasibinomial, data = success_lag
)
summary(m2_succ_rain_lag)
```

### Wind and Hail

```{r}
m2_succ_wind_lag <- glm(
  cbind(success_nests, failed_nests) ~ z_lag_mean_wind + z_lag_max_wind + z_lag_hail_days,
  family = quasibinomial, data = success_lag
)
summary(m2_succ_wind_lag)
```


## Objective 3

```{r}
library(dplyr)
library(purrr)
library(tidyr)
library(lubridate)

summarise_60 <- function(lay_date, weather) {
  w <- weather %>%
    filter(date > (lay_date - days(60)), date <= lay_date)
  
  tibble(
    mean_temp_60  = mean(w$mean_temp, na.rm = TRUE),
    max_temp_60   = mean(w$max_temp,  na.rm = TRUE),
    min_temp_60   = mean(w$min_temp,  na.rm = TRUE),
    total_rain_60 = sum(w$rain,       na.rm = TRUE),
    rain_days_60  = sum(w$rain_day,   na.rm = TRUE),
    mean_wind_60  = mean(w$mean_wind, na.rm = TRUE),
    max_wind_60   = mean(w$max_wind,  na.rm = TRUE),
    hail_days_60  = sum(w$I_HAIL,     na.rm = TRUE)
  )
}

```

```{r}
timing_weather_60 <- timing_df %>%
  mutate(window_60 = map(laying.date, summarise_60, weather = weather_df)) %>%
  unnest(window_60)

```

### Temperature 

```{r}
m_timing_temp_60 <- lm(
  lay_DOY ~ mean_temp_60 + max_temp_60 + min_temp_60,
  data = timing_weather_60
)
summary(m_timing_temp_60)
```

### Rainfall 
```{r}
m_timing_rain_60 <- lm(
  lay_DOY ~ rain_days_60,
  data = timing_weather_60
)
summary(m_timing_rain_60)
```

### Wind 
```{r}
m_timing_wind_60 <- lm(
  lay_DOY ~ mean_wind_60 + max_wind_60,
  data = timing_weather_60
)
summary(m_timing_wind_60)
```

### Hail 

```{r}
m_timing_hail_60 <- lm(
  lay_DOY ~ hail_days_60,
  data = timing_weather_60
)
summary(m_timing_hail_60)
```

:::



































































































































































































































































